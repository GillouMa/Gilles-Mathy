---
title: "Mathy"
author: "Gilles Mathy"
format: html
editor: visual
---

```{r}
library(here)
library(readr)
```
```{r}
here::i_am("Gilles-Mathy.Rproj")
```
### Question 1
```{r}
courses <- read_csv(here("courses.csv"))
```

### Question 2

```{r}
library(dplyr)
library(knitr)

courses |>
  arrange(course) |> 
  rename(
    "course name"      = course,
    "identifier"       = course_id,
    "trimester"        = trimester,
    "number of grades" = nb_grades
  ) |>
  kable()

```

## 1.2 Students

### Question 3

```{r}
students <- read_csv(
  here("students.csv"),
  col_types = cols(
    id         = col_integer(),
    group      = col_factor(),
    birth_date = col_date(format = "%Y-%m-%d"),
    sex        = col_factor()
  )
)
```

The `birth_date` column of the `students` data frame is of class `r class(students$birth_date)`.
The `sex` column of the `students` data frame is of class `r class(students$sex)`

## 1.3 Grades

### Question 4 

```{r}
grades <- read_delim(
  here("grades.csv"),
  delim = ";",
  na = "unknown",
  col_types = cols(
    id        = col_integer(),
    course_id = col_integer(),
    grade     = col_double()
  ),
  show_col_types = FALSE
)
```

# Student Population Analysis

### Question 5

```{r}
library(ggplot2)

students <- students |>
  mutate(
    group = as.integer(as.character(group))   
  )

students_per_group <- students |>
  count(group)

ggplot(students_per_group, aes(x = factor(group), y = n)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal()
```

### Question 6

```{r}
gender_group <- students |>
  count(group, sex)

ggplot(gender_group, aes(x = factor(group), y = n, fill = sex)) +
  geom_col(position = "fill") +
  labs(
    title = "Gender Balance per Group (Proportion)",
    x = "Group",
    y = "Proportion",
    fill = "Sex"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()
```

### Question 7

```{r}
library(lubridate)

students <- students |>
  mutate(
    age = round(time_length(today() - birth_date, unit = "year"))
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "steelblue", color = "white") +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal()
```

### Question 8

```{r}
median_age_group <- students |>
  group_by(group) |>
  summarise(
    median_age = round(median(age), 0)
  ) |>
  arrange(group)

kable(median_age_group, caption = "Median Age of Students per Group")
```

### Question 9

```{r}
oldest_per_group <- students |>
  group_by(group) |>
  slice_max(age, n = 1, with_ties = FALSE) |>   # pick the oldest student
  ungroup() |>
  select(group, id, sex, age) |>                # keep only needed columns
  arrange(desc(age))                            # sort by age decreasing

kable(oldest_per_group, caption = "Oldest Student in Each Group")
```


















